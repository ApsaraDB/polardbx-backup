diff a/storage/innobase/trx/trx0purge.cc b/storage/innobase/trx/trx0purge.cc	(rejected hunks)
@@ -1821,6 +1824,7 @@ static trx_undo_rec_t *trx_purge_get_next_rec(
         trx_undo_page_get_s_latched(page_id_t(space, page_no), page_size, &mtr);
 
     rec = undo_page + offset;
+
   } else {
     page = page_align(rec2);
 
@@ -1856,16 +1860,19 @@ static MY_ATTRIBUTE((warn_unused_result))
                                 handled */
         mem_heap_t *heap)       /*!< in: memory heap where copied */
 {
+  bool keep_top = false;
   if (!purge_sys->next_stored) {
-    trx_purge_choose_next_log();
+    keep_top = trx_purge_choose_next_log();
 
-    if (!purge_sys->next_stored) {
+    /** keep_top == true mean the top of heap is larger than purge_sys's
+    vision. That is to say, there are logs left in the history list */
+    if (!purge_sys->next_stored && !keep_top) {
       DBUG_PRINT("ib_purge", ("no logs left in the history list"));
       return (NULL);
     }
   }
 
-  if (purge_sys->iter.scn > purge_sys->vision.snapshot_scn()) {
+  if (purge_sys->iter.scn > purge_sys->vision.snapshot_scn() || keep_top) {
     return NULL;
   }
 
